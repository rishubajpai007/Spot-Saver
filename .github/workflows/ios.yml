name: iOS CI

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  build-test:
    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v4

    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: latest-stable

    # Debug step to verify file structure if needed
    - name: List files (Debug)
      run: ls -R

    - name: Install dependencies
      run: |
        if [ -f "Spot Saver/Podfile" ]; then 
            cd "Spot Saver" && pod install && cd ..
        fi

    - name: Run Tests
      run: |
        # This command now uses 'test' instead of 'build'
        # It requires the Scheme to be SHARED in Xcode for it to work.
        
        xcodebuild \
        -project "Spot Saver/Spot Saver.xcodeproj" \
        -scheme "Spot Saver" \
        -destination 'platform=iOS Simulator,name=iPhone 16' \
        clean test
